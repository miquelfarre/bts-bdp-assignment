= Session 6: NoSQL - MongoDB
:toc:

== Overview

In this assignment you will build a REST API backed by MongoDB to manage aircraft position data.

You must implement all the endpoints defined in `exercise.py` so that the evaluation tests in `tests/s6/test_s6.py` pass.

== Prerequisites

* MongoDB running via Docker
* Python dependencies installed: `pip install -r requirements.txt`

== MongoDB Setup

Start MongoDB with Docker Compose:

[source,bash]
----
make mongo
----

To stop it:

[source,bash]
----
make mongo_stop
----

== Configuration

Set the MongoDB URL via environment variable:

[source,bash]
----
export BDI_MONGO_URL="mongodb://admin:admin123@localhost:27017"
----

== Running

[source,bash]
----
uvicorn bdi_api.app:app --reload --port 8080
----

Visit http://localhost:8080/docs to see and test the API.

== Evaluation

[source,bash]
----
pytest tests/s6/ -v
----

All tests in `TestItCanBeEvaluated` must pass. Do NOT modify those tests.

== Endpoints

|===
|Method |Path |Description

|POST |`/api/s6/aircraft` |Store an aircraft position
|GET |`/api/s6/aircraft/` |List aircraft (paginated)
|GET |`/api/s6/aircraft/{icao}` |Get latest position for an aircraft
|GET |`/api/s6/aircraft/stats` |Count positions by aircraft type
|DELETE |`/api/s6/aircraft/{icao}` |Delete all records for an aircraft
|===

== Hints

* Use `pymongo.MongoClient` to connect
* The `_id` field is auto-generated by MongoDB, exclude it from responses with projection `{"_id": 0}`
* For aggregation stats, use `collection.aggregate()` with `$group`
* For pagination, use `.skip()` and `.limit()`
* For the GET by icao, sort by timestamp descending to get the latest
* Return HTTP 404 if aircraft not found
